/* 
*  Name: dpdatepicker 
*  Description: Datepicker - AngularJS reusable UI component 
*  Version: 0.1.0 
*  Author: kekeh 
*  Homepage: http://kekeh.github.io/dpdatepicker 
*  License: MIT 
*  Date: 2015-07-31 
*/ 
angular.module('template-dpdatepicker-0.1.0.html', ['templates/dpdatepicker.html']);

angular.module("templates/dpdatepicker.html", []).run(["$templateCache", function($templateCache) {
  $templateCache.put("templates/dpdatepicker.html",
    "<div class=\"dpdatepicker\" ng-style=\"{'width':width}\">\n" +
    "    <div class=\"dpselectiongroup\" ng-click=\"picker($event)\">\n" +
    "        <span class=\"dpselection\" ng-style=\"{'line-height': height}\" ng-click=\"picker($event)\" tooltip-window>{{selectionDayTxt}}</span>\n" +
    "        <span class=\"dpselbtngroup\" ng-style=\"{'height': height}\">\n" +
    "            <button class=\"dpbtnclear\" ng-show=\"selectionDayTxt.length > 0\" ng-click=\"clearSelection($event)\" ng-mouseenter=\"$event.stopPropagation()\"><span class=\"icon icon-cross\"></span></button>\n" +
    "            <button class=\"dpbtnpicker\" ng-click=\"picker($event)\" ng-mouseenter=\"$event.stopPropagation()\"><span class=\"icon icon-calendar\"></span></button>\n" +
    "        </span>\n" +
    "    </div>\n" +
    "    <div class=\"dpselector\" ng-if=\"showSelector\">\n" +
    "        <table class=\"dpheader\">\n" +
    "            <tr>\n" +
    "                <td>\n" +
    "                    <div style=\"float:left\">\n" +
    "                        <div class=\"dpheaderbtn\" ng-click=\"prevMonth()\"><span class=\"icon icon-left\"></span></div>\n" +
    "                        <div class=\"dpheadermonthtxt\" ng-bind=\"visibleMonth.monthTxt\"></div>\n" +
    "                        <div class=\"dpheaderbtn\" ng-click=\"nextMonth()\"><span class=\"icon icon-right\"></span></div>\n" +
    "                    </div>\n" +
    "                </td>\n" +
    "                <td>\n" +
    "                    <button class=\"dpheadertodaybtn\" ng-click=\"today()\">{{options.todayBtnText!==undefined?options.todayBtnText:cf.todayBtnText}}</button>\n" +
    "                </td>\n" +
    "                <td>\n" +
    "                    <div style=\"float:right\">\n" +
    "                        <div class=\"dpheaderbtn\" ng-click=\"prevYear()\"><span class=\"icon icon-left\"></span></div>\n" +
    "                        <div class=\"dpheaderyeartxt\" ng-bind=\"visibleMonth.year\"></div>\n" +
    "                        <div class=\"dpheaderbtn\" ng-click=\"nextYear()\"><span class=\"icon icon-right\"></span></div>\n" +
    "                    </div>\n" +
    "                </td>\n" +
    "            </tr>\n" +
    "        </table>\n" +
    "        <table class=\"dptable\">\n" +
    "            <thead><tr><th ng-repeat=\"d in weekDays track by $index\" ng-bind=\"d\"></th></tr></thead>\n" +
    "            <tbody>\n" +
    "                <tr ng-repeat=\"w in dates track by $index\">\n" +
    "                    <td ng-repeat=\"d in w track by $index\" ng-class=\"{'dpcurrmonth':d.cmo===cf.CURR_MONTH, 'dpcurrday':d.currDay && (options.currDayHighlight!==undefined?options.currDayHighlight:cf.currDayHighlight),'dpselectedday':selectedDate.day===d.day && selectedDate.month===d.month && selectedDate.year===d.year && d.cmo===cf.CURR_MONTH}\" ng-click=\"cellClicked(d)\">\n" +
    "                        <span style=\"background-color:inherit\" ng-class=\"{'dpprevmonth':d.cmo===cf.PREV_MONTH,'dpcurrmonth':d.cmo===cf.CURR_MONTH,'dpnextmonth':d.cmo===cf.NEXT_MONTH,'dpsunday':d.sun && d.cmo===cf.CURR_MONTH && (options.sunHighlight!==undefined?options.sunHighlight:cf.sunHighlight)}\" ng-bind=\"d.day\"></span>\n" +
    "                    </td>\n" +
    "                </tr>\n" +
    "            </tbody>\n" +
    "        </table>\n" +
    "        <div class=\"dpfooterarea\" ng-if=\"options.footer!==undefined && options.footer.visible!==undefined?options.footer.visible:cf.footer.visible\">\n" +
    "            <button class=\"dpfooterbtn\" ng-class=\"{'dpbtndisable': selectedDate.day===0}\" ng-disabled=\"selectedDate.day===0\" ng-click=\"accept()\">{{options.footer.okBtnText!==undefined?options.footer.okBtnText:cf.footer.okBtnText}}</button>\n" +
    "        </div>\n" +
    "    </div>\n" +
    "\n" +
    "    <script type=\"text/ng-template\" id=\"datepickertooltip.html\">\n" +
    "        <div class=\"vstooltip\" ng-click=\"closeTooltip($event)\"><span class=\"vstooltiptext\">{{selectionDayTxt}}</span></div>\n" +
    "    </script>\n" +
    "</div>");
}]);

angular.module("dpdatepicker",["template-dpdatepicker-0.1.0.html"]).constant("dpdatepickerConfig",{dateFormat:"dd.mm.yyyy",monthLabels:{1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec"},dayLabels:{su:"Sun",mo:"Mon",tu:"Tue",we:"Wed",th:"Thu",fr:"Fri",sa:"Sat"},todayBtnText:"Today",sunHighlight:!0,currDayHighlight:!0,closeOnSelect:!1,footer:{visible:!0,okBtnText:"OK"},YEAR_CONST:"yyyy",MONTH_CONST:"mm",DATE_CONST:"dd",PREV_MONTH:1,CURR_MONTH:2,NEXT_MONTH:3,TOOLTIP_SHOW_DELAY:600,HEIGHT:"30px",WIDTH:"140px"}).service("dpdatepickerService",["$http","$templateCache",function(a,b){this.getTemplate=function(c){var d=a.get(c,{cache:b}).success(function(a){return a.data});return d}}]).directive("dpdatepicker",["$timeout","$document",function(a,b){return{restrict:"EA",templateUrl:"templates/dpdatepicker.html",scope:{ngModel:"=?",options:"="},controller:["$scope","dpdatepickerConfig",function(a,b){a.cf=b}],link:function(c,d,e){function f(a){c.options.dateSelectCb&&c.options.dateSelectCb(a.year,a.month,a.day,c.selectionDayTxt),c.ngModel=c.selectionDayTxt}function g(a){var b=angular.copy(angular.isUndefined(c.options.dateFormat)?c.cf.dateFormat:c.options.dateFormat);c.selectionDayTxt=b.replace(c.cf.YEAR_CONST,a.year).replace(c.cf.MONTH_CONST,h(a.month)).replace(c.cf.DATE_CONST,h(a.day))}function h(a){return 10>a?"0"+a:a}function i(a){return p()[a]}function j(a,b){var c=new Date;return c.setDate(1),c.setMonth(b-1),c.setYear(a),c.getDay()}function k(a,b){return new Date(b,a,0).getDate()}function l(a,b){return 1===a?(a=12,b--):a--,k(a,b)}function m(a,b,c,d){return a===s.getDate()&&b===s.getMonth()+1&&c===s.getFullYear()&&2===d}function n(a,b){c.dates.length=0;for(var d=j(b,a),e=k(a,b),f=l(a,b),g=1,h=c.cf.PREV_MONTH,i=1;7>i;i++){var n=[];if(1===i){for(var o=f-d+1,p=o;f>=p;p++)n.push({day:p,month:a,year:b,cmo:h,currDay:m(p,a,b,h),sun:0===n.length});h=c.cf.CURR_MONTH;for(var q=7-n.length,p=0;q>p;p++)n.push({day:g,month:a,year:b,cmo:h,currDay:m(g,a,b,h),sun:0===n.length}),g++}else for(var p=1;8>p;p++)g>e&&(g=1,h=c.cf.NEXT_MONTH),n.push({day:g,month:a,year:b,cmo:h,currDay:m(g,a,b,h),sun:0===n.length}),g++;c.dates.push(n)}}function o(a){d[0].contains(a.target)||1!==a.which||(c.showSelector&&(c.showSelector=!1),c.$apply())}function p(){return angular.isUndefined(c.options.monthLabels)?c.cf.monthLabels:c.options.monthLabels}function q(){return angular.isUndefined(c.options.dayLabels)?c.cf.dayLabels:c.options.dayLabels}function r(){c.height=angular.isUndefined(e.height)?c.height:e.height,c.width=angular.isUndefined(e.width)?c.width:e.width;var a=["su","mo","tu","we","th","fr","sa"];for(var d in a)c.weekDays.push(q()[a[d]]);void 0!==c.options.initSelectedDate&&(g(c.options.initSelectedDate),c.selectedDate=angular.copy(c.options.initSelectedDate)),b.on("click",o)}c.weekDays=[],c.dates=[],c.selectionDayTxt="",c.selectedDate={day:0,month:0,year:0},c.visibleMonth={monthTxt:"",monthNbr:0,year:0},c.showSelector=!1,c.width=c.cf.WIDTH,c.height=c.cf.HEIGHT;var s=new Date;c.prevMonth=function(){var a=c.visibleMonth.monthNbr,b=c.visibleMonth.year;1===a?(a=12,b--):a--,c.visibleMonth={monthTxt:i(a),monthNbr:a,year:b}},c.nextMonth=function(){var a=c.visibleMonth.monthNbr,b=c.visibleMonth.year;12===a?(a=1,b++):a++,c.visibleMonth={monthTxt:i(a),monthNbr:a,year:b}},c.prevYear=function(){c.visibleMonth.year=c.visibleMonth.year-1},c.nextYear=function(){c.visibleMonth.year=c.visibleMonth.year+1},c.today=function(){var a=s.getMonth()+1;c.visibleMonth={monthTxt:i(a),monthNbr:a,year:s.getFullYear()}},c.cellClicked=function(a){if(a.cmo===c.cf.PREV_MONTH)c.prevMonth();else if(a.cmo===c.cf.CURR_MONTH){c.selectedDate={day:a.day,month:a.month,year:a.year};var b=angular.isUndefined(c.options.closeOnSelect)?c.cf.closeOnSelect:c.options.closeOnSelect;b&&(g(a),f(a),c.showSelector=!1)}else a.cmo===c.cf.NEXT_MONTH&&c.nextMonth()},c.picker=function(a){if(a.stopPropagation(),c.showSelector=!c.showSelector,c.showSelector){var b=0,d=0;void 0===c.options.initSelectorMonth?(b=s.getFullYear(),d=s.getMonth()+1):(b=c.options.initSelectorMonth.year,d=c.options.initSelectorMonth.month),c.visibleMonth={monthTxt:p()[d],monthNbr:d,year:b},n(d,b)}},c.clearSelection=function(a){a.stopPropagation(),c.selectionDayTxt="",c.selectedDate={day:0,month:0,year:0},f(c.selectedDate)},c.accept=function(){g(c.selectedDate),f(c.selectedDate),c.showSelector=!1},c.$watch("visibleMonth",function(a,b){a!==b&&n(a.monthNbr,a.year)},!0),c.$on("$destroy",function(){b.off("click",o)}),a(r)}}}]).directive("tooltipWindow",["$compile","$timeout","dpdatepickerService",function(a,b,c){return{restrict:"A",scope:!1,link:function(d,e,f){function g(){e[0].scrollWidth>e[0].offsetWidth&&(m=b(function(){c.getTemplate("datepickertooltip.html").then(function(b){l=angular.element(b.data),k.prepend(a(l)(d))})},d.cf.TOOLTIP_SHOW_DELAY))}function h(){i(),null!==l&&(l.remove(),l=null)}function i(){b.cancel(m),m=null}function j(){k=e.parent(),k.on("mouseenter",g),k.on("mouseleave",h)}var k=null,l=null,m=null;d.closeTooltip=function(a){a.stopPropagation(),h()},d.$on("$destroy",function(){k.off("mouseenter",g),k.off("mouseleave",h)}),j()}}}]);